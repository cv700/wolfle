<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Werewolf Game</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .game-container { text-align: center; max-width: 600px; margin: 0 auto; padding: 20px; }
        .game-board { display: grid; gap: 5px; margin: 20px auto; }
        .tile { aspect-ratio: 1; font-size: 24px; background-color: #fff; border: 1px solid #ccc; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; }
        .popup-content { background-color: white; padding: 20px; border-radius: 10px; text-align: center; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const useGameBoard = (gridSize, professionEmojis, otherEmojis) => {
          const [gameBoard, setGameBoard] = React.useState([]);
          const [werewolfIndex, setWerewolfIndex] = React.useState(-1);
          const [isLoading, setIsLoading] = React.useState(true);
          const [error, setError] = React.useState(null);
          const initAttempts = React.useRef(0);

          const initializeBoard = React.useCallback(() => {
            console.log("Initializing board...");
            setIsLoading(true);
            setError(null);
            try {
              const totalTiles = gridSize * gridSize;
              const requiredPairs = Math.floor(totalTiles / 2) - 1;
              let selectedEmojis = [];

              while (selectedEmojis.length < requiredPairs) {
                const randomProfession = professionEmojis[Math.floor(Math.random() * professionEmojis.length)];
                const randomEmoji = randomProfession[Math.floor(Math.random() * 2)];
                if (!selectedEmojis.includes(randomEmoji)) {
                  selectedEmojis.push(randomEmoji);
                }
              }

              selectedEmojis = [...selectedEmojis, ...selectedEmojis];
              const werewolfEmoji = '🐺';
              const newWerewolfIndex = Math.floor(Math.random() * totalTiles);
              selectedEmojis.splice(newWerewolfIndex, 0, werewolfEmoji);

              const newBoard = selectedEmojis.sort(() => 0.5 - Math.random()).map(emoji => ({ 
                emoji, 
                isClicked: false,
                isMatched: false
              }));

              console.log("Board initialized:", newBoard);
              setGameBoard(newBoard);
              setWerewolfIndex(newWerewolfIndex);
              setIsLoading(false);
              initAttempts.current = 0;
            } catch (err) {
              console.error("Error initializing board:", err);
              setError("Failed to initialize game board. Retrying...");
              if (initAttempts.current < 3) {
                initAttempts.current += 1;
                setTimeout(initializeBoard, 1000);
              } else {
                setError("Failed to initialize game board after multiple attempts. Please refresh the page.");
                setIsLoading(false);
              }
            }
          }, [gridSize, professionEmojis, otherEmojis]);

          React.useEffect(() => {
            console.log("useEffect triggered for board initialization");
            initializeBoard();
          }, [initializeBoard]);

          return { gameBoard, setGameBoard, werewolfIndex, isLoading, error, initializeBoard };
        };

        const EmojiWerewolfGame = () => {
            console.log("Component rendering");

            const [gameBoard, setGameBoard] = React.useState([]);
            const [isLoading, setIsLoading] = React.useState(true);
            const [lastTapTime, setLastTapTime] = React.useState(0);
            const [lastTapIndex, setLastTapIndex] = React.useState(-1);

            React.useEffect(() => {
                console.log("useEffect triggered");
                
                const initializeBoard = () => {
                    console.log("Initializing board");
                    const festiveEmojis = [
                        '🎃', // Jack-o'-lantern (keeping this as the only object)
                        '👻', // Ghost
                        '🧟', // Zombie
                        '🧛', // Vampire
                        '🧙', // Mage/Witch
                        '🧚', // Fairy
                        '🧝', // Elf
                        '🦄', // Unicorn (mythical character)
                        '🎅', // Santa Claus
                        '🤶', // Mrs. Claus
                        '🦌', // Deer (Reindeer)
                        '⛄', // Snowman (considered a character in this context)
                        '🧞', // Genie
                        '🧜', // Merperson
                        '🧛‍♀️', // Female Vampire
                        '🧙‍♀️', // Female Mage/Witch
                        '🧝‍♀️', // Female Elf
                        '🧞‍♀️', // Female Genie
                        '🧜‍♀️', // Mermaid
                        '🦹', // Supervillain
                    ];
                    const werewolfEmoji = '🐺'; // Werewolf
                    
                    // Create a board with random emojis, ensuring at least one werewolf
                    const dummyBoard = Array(49).fill(null).map(() => ({
                        emoji: festiveEmojis[Math.floor(Math.random() * festiveEmojis.length)],
                        isClicked: false,
                        isMatched: false
                    }));
                    
                    // Ensure there's at least one werewolf
                    const werewolfIndex = Math.floor(Math.random() * dummyBoard.length);
                    dummyBoard[werewolfIndex].emoji = werewolfEmoji;

                    console.log("Dummy board created:", dummyBoard);
                    setGameBoard(dummyBoard);
                    setIsLoading(false);
                };

                initializeBoard();
            }, []);

            const handleTileInteraction = (index) => {
                const currentTime = new Date().getTime();
                const tapTimeDiff = currentTime - lastTapTime;

                if (tapTimeDiff < 300 && index === lastTapIndex) {
                    console.log("Double tap detected on index:", index);
                    // Handle double tap logic here
                    alert(`Double tap detected on emoji: ${gameBoard[index].emoji}`);
                } else {
                    setLastTapTime(currentTime);
                    setLastTapIndex(index);
                }
            };

            console.log("Current state - isLoading:", isLoading, "gameBoard length:", gameBoard.length);

            if (isLoading) {
                return <div>Initializing game board... Please wait.</div>;
            }

            return (
                <div className="game-container" style={{
                    fontFamily: 'Arial, sans-serif',
                    textAlign: 'center',
                    maxWidth: '100%',
                    margin: '0 auto',
                    padding: '20px',
                    boxSizing: 'border-box'
                }}>
                    <h1 style={{
                        fontSize: 'clamp(24px, 5vw, 36px)',
                        margin: '0 0 10px 0'
                    }}>Emoji Werewolf Game</h1>
                    <p style={{
                        fontSize: 'clamp(16px, 3vw, 18px)',
                        fontWeight: 'bold',
                        margin: '0 0 20px 0'
                    }}>
                        Double tap the odd one out
                    </p>
                    <div className="game-board" style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(7, 1fr)',
                        gap: '5px',
                        width: '90vmin',
                        height: '90vmin',
                        maxWidth: '500px',
                        maxHeight: '500px',
                        margin: '0 auto',
                        touchAction: 'manipulation'
                    }}>
                        {gameBoard.map((tile, index) => (
                            <div 
                                key={index} 
                                style={{
                                    aspectRatio: '1',
                                    backgroundColor: '#fff',
                                    border: '1px solid #ccc',
                                    display: 'flex',
                                    justifyContent: 'center',
                                    alignItems: 'center',
                                    fontSize: 'clamp(16px, 4vmin, 24px)',
                                    cursor: 'pointer',
                                    userSelect: 'none',
                                    touchAction: 'manipulation'
                                }}
                                onClick={() => handleTileInteraction(index)}
                                onTouchStart={() => handleTileInteraction(index)}
                            >
                                {tile.emoji}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<EmojiWerewolfGame />, document.getElementById('root'));
    </script>
</body>
</html>
